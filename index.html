<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDC Learn - Training</title>
    <style>
        /* --- CSS GIỮ NGUYÊN & THÊM MỚI --- */
        body, html { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; height: 100%; background-color: #f0f2f5; }
        
        /* Màn hình chung */
        .screen { display: none; height: 100%; padding: 20px; box-sizing: border-box; }
        .active { display: flex !important; flex-direction: column; align-items: center; }

        /* HOME SCREEN */
        #home-screen { background-color: #000080; color: white; justify-content: center; }
        h1.logo { font-size: 3.5rem; margin-bottom: 30px; font-weight: bold; text-align: center; }
        .input-group { display: flex; flex-direction: column; gap: 15px; width: 300px; max-width: 90%; }
        input[type="text"], input[type="password"] { padding: 15px; font-size: 1.1rem; border-radius: 8px; border: none; outline: none; }
        button { padding: 15px; font-size: 1.1rem; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-start { background-color: #ff9800; color: white; }
        .btn-start:hover { background-color: #e68900; }
        
        .admin-link { margin-top: 20px; color: #accaff; cursor: pointer; text-decoration: underline; font-size: 0.9rem; }

        /* TEST SCREEN */
        #test-screen { max-width: 800px; margin: 0 auto; display: none; padding-bottom: 80px; }
        .question-card { background: white; border-radius: 10px; margin-bottom: 20px; padding: 15px; width: 100%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .q-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .q-text { font-weight: bold; font-size: 1.1rem; color: #333; }
        .btn-ng { background-color: #dc3545; color: white; padding: 5px 15px; border-radius: 5px; font-size: 0.9rem; }
        .q-image-container img { max-width: 100%; max-height: 300px; display: block; margin: 0 auto; border-radius: 5px; }
        .confirmed-text { color: green; font-weight: bold; text-align: center; padding: 20px; font-size: 1.2rem; }
        
        .footer-action { position: fixed; bottom: 20px; left: 20px; z-index: 100; }
        .btn-ok { background-color: #28a745; color: white; padding: 12px 30px; border-radius: 50px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        /* RESULT SCREEN */
        #result-screen { justify-content: center; }
        .result-box { background: white; padding: 30px; border-radius: 10px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        .score-display { font-size: 4rem; color: #000080; font-weight: bold; margin: 10px 0; }
        .btn-continue { background-color: #000080; color: white; width: 100%; margin-top: 20px; }

        /* ADMIN SCREEN */
        #admin-screen { background-color: #fff; color: #333; display: none; }
        .admin-header { width: 100%; max-width: 800px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .admin-table { width: 100%; max-width: 800px; border-collapse: collapse; margin-top: 10px; }
        .admin-table th, .admin-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .admin-table th { background-color: #000080; color: white; }
        .btn-back { background-color: #6c757d; color: white; padding: 8px 15px; font-size: 0.9rem; }

        /* MODAL */
        #modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center; }
        .modal-box { background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 500px; }
        .answer-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .answer-option { padding: 12px; background: #e9ecef; text-align: center; cursor: pointer; border-radius: 5px; font-size: 0.9rem; user-select: none; }
        .answer-option.selected { background: #cce5ff; border: 2px solid #007bff; color: #004085; padding: 10px; } /* Trừ border */
        
        /* ADMIN LOGIN MODAL */
        #admin-login-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 30px; border-radius: 8px; text-align: center; width: 300px; }
        .btn-login { background-color: #000080; color: white; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="home-screen" class="screen active">
        <h1 class="logo">SDC Learn</h1>
        <div class="input-group">
            <input type="text" id="employee-code" placeholder="Nhập mã nhân viên..." required>
            <button class="btn-start" onclick="startTest()">START</button>
        </div>
        <div class="admin-link" onclick="showAdminLogin()">Admin Dashboard</div>
    </div>

    <div id="test-screen" class="screen">
        <div id="questions-container"></div>
        <div class="footer-action">
            <button class="btn-ok" onclick="finishTest()">OK (Hoàn thành)</button>
        </div>
    </div>

    <div id="result-screen" class="screen">
        <div class="result-box">
            <h2>Kết Quả</h2>
            <p>Nhân viên: <span id="res-employee" style="font-weight:bold"></span></p>
            <div class="score-display">
                <span id="res-score">0</span><span style="font-size: 2rem; color: #666">/10</span>
            </div>
            <p>Thời gian: <span id="res-time">00:00</span></p>
            <button class="btn-continue" onclick="goHome()">Continue</button>
        </div>
    </div>

    <div id="admin-screen" class="screen">
        <div class="admin-header">
            <h2>Quản trị viên (Admin)</h2>
            <button class="btn-back" onclick="goHome()">Đăng xuất</button>
        </div>
        <p>Lịch sử kiểm tra (Lưu tại máy này):</p>
        <div style="overflow-x: auto;">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Thời gian</th>
                        <th>Mã NV</th>
                        <th>Điểm</th>
                        <th>Chi tiết</th>
                    </tr>
                </thead>
                <tbody id="admin-table-body">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="modal-overlay">
        <div class="modal-box">
            <h3 style="margin-top:0">Chọn lỗi:</h3>
            <div class="answer-grid" id="answer-grid"></div>
            <div style="text-align: right; margin-top: 20px;">
                <button style="background:#007bff; color:white; padding: 10px 20px;" onclick="confirmAnswer()">Xác nhận</button>
            </div>
        </div>
    </div>

    <div id="admin-login-modal">
        <div class="login-box">
            <h3>Đăng nhập Admin</h3>
            <input type="password" id="admin-pass-input" placeholder="Mật khẩu..." style="width: 80%; margin-bottom: 10px;">
            <button class="btn-login" onclick="checkAdminPass()">Đăng nhập</button>
            <div style="margin-top: 10px; font-size: 0.8rem; cursor: pointer; color: #666;" onclick="closeAdminLogin()">Huỷ bỏ</div>
        </div>
    </div>

    <script>
        /* --- CẤU HÌNH --- */
        const ADMIN_PASSWORD = "admin"; // <--- Đổi mật khẩu admin tại đây
        
        const FIXED_ANSWERS = [
            "Lỗi ngoại quan", "Sai kích thước", "Thiếu linh kiện", 
            "Lắp ngược", "Bẩn/Xước", "Dị vật", 
            "Lỗi hàn", "Nứt/Gãy", "Sai màu", 
            "Biến dạng", "Tem nhãn sai", "Khác"
        ];

        // Thêm hình ảnh thật của bạn vào đây
        const QUESTION_BANK = [
            { id: 1, text: "Lỗi gì trong hình này?", image: "https://via.placeholder.com/400x200?text=Question+1", correct: "Lỗi ngoại quan" },
            { id: 2, text: "Xác định lỗi sản phẩm?", image: "https://via.placeholder.com/400x200?text=Question+2", correct: "Sai kích thước" },
            { id: 3, text: "Vị trí này bị gì?", image: "https://via.placeholder.com/400x200?text=Question+3", correct: "Thiếu linh kiện" },
            { id: 4, text: "Kiểm tra lỗi?", image: "https://via.placeholder.com/400x200?text=Question+4", correct: "Lắp ngược" },
            { id: 5, text: "Bề mặt bị sao?", image: "https://via.placeholder.com/400x200?text=Question+5", correct: "Bẩn/Xước" },
            { id: 6, text: "Tìm lỗi?", image: "https://via.placeholder.com/400x200?text=Question+6", correct: "Dị vật" },
            { id: 7, text: "Mối nối thế nào?", image: "https://via.placeholder.com/400x200?text=Question+7", correct: "Lỗi hàn" },
            { id: 8, text: "Cấu trúc bị gì?", image: "https://via.placeholder.com/400x200?text=Question+8", correct: "Nứt/Gãy" },
            { id: 9, text: "Màu sắc sản phẩm?", image: "https://via.placeholder.com/400x200?text=Question+9", correct: "Sai màu" },
            { id: 10, text: "Hình dạng sản phẩm?", image: "https://via.placeholder.com/400x200?text=Question+10", correct: "Biến dạng" },
            { id: 11, text: "Kiểm tra tem?", image: "https://via.placeholder.com/400x200?text=Question+11", correct: "Tem nhãn sai" },
            { id: 12, text: "Lỗi không xác định?", image: "https://via.placeholder.com/400x200?text=Question+12", correct: "Khác" }
        ];

        /* --- LOGIC --- */
        let currentQuestions = [], userAnswers = {}, currentEmpCode = "", startTime = null;
        let activeQuestionId = null, selectedOption = null;

        // Init
        (function init(){
            const grid = document.getElementById('answer-grid');
            FIXED_ANSWERS.forEach(ans => {
                const div = document.createElement('div');
                div.className = 'answer-option';
                div.innerText = ans;
                div.onclick = () => {
                    document.querySelectorAll('.answer-option').forEach(el => el.classList.remove('selected'));
                    div.classList.add('selected');
                    selectedOption = ans;
                };
                grid.appendChild(div);
            });
        })();

        // Navigation
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // --- USER FLOW ---
        function startTest() {
            const code = document.getElementById('employee-code').value.trim();
            if(!code) return alert("Vui lòng nhập mã nhân viên!");
            currentEmpCode = code;
            currentQuestions = [...QUESTION_BANK].sort(() => 0.5 - Math.random()).slice(0, 10);
            userAnswers = {};
            startTime = new Date();
            
            const container = document.getElementById('questions-container');
            container.innerHTML = "";
            currentQuestions.forEach((q, idx) => {
                const div = document.createElement('div');
                div.className = 'question-card';
                div.id = `card-${q.id}`;
                div.innerHTML = `
                    <div class="q-header">
                        <div class="q-text">Câu ${idx+1}: ${q.text}</div>
                        <button class="btn-ng" onclick="openAnswerModal(${q.id})">NG</button>
                    </div>
                    <div class="q-image-container"><img src="${q.image}"></div>
                `;
                container.appendChild(div);
            });

            showScreen('test-screen');
        }

        function openAnswerModal(qId) {
            activeQuestionId = qId;
            selectedOption = null;
            document.querySelectorAll('.answer-option').forEach(el => el.classList.remove('selected'));
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function confirmAnswer() {
            if (!selectedOption) return alert("Chọn 1 đáp án!");
            userAnswers[activeQuestionId] = selectedOption;
            document.getElementById(`card-${activeQuestionId}`).innerHTML = `<div class="confirmed-text">ĐÃ XÁC NHẬN</div>`;
            document.getElementById('modal-overlay').style.display = 'none';
        }

        function finishTest() {
            if(Object.keys(userAnswers).length < 10) {
                if(!confirm(`Mới làm ${Object.keys(userAnswers).length}/10 câu. Nộp luôn?`)) return;
            }
            
            let score = 0;
            currentQuestions.forEach(q => { if(userAnswers[q.id] === q.correct) score++; });
            
            const timeDiff = Math.floor((new Date() - startTime) / 1000);
            const m = Math.floor(timeDiff/60).toString().padStart(2,'0');
            const s = (timeDiff%60).toString().padStart(2,'0');

            // Save Result
            saveResultToStorage(currentEmpCode, score, `${m}:${s}`);

            // Show Result
            document.getElementById('res-employee').innerText = currentEmpCode;
            document.getElementById('res-score').innerText = score;
            document.getElementById('res-time').innerText = `${m}:${s}`;
            showScreen('result-screen');
        }

        function goHome() {
            document.getElementById('employee-code').value = "";
            document.getElementById('admin-login-modal').style.display = 'none';
            showScreen('home-screen');
        }

        // --- ADMIN FLOW ---
        function showAdminLogin() { document.getElementById('admin-login-modal').style.display = 'flex'; }
        function closeAdminLogin() { document.getElementById('admin-login-modal').style.display = 'none'; }
        
        function checkAdminPass() {
            const pass = document.getElementById('admin-pass-input').value;
            if(pass === ADMIN_PASSWORD) {
                loadAdminData();
                showScreen('admin-screen');
                closeAdminLogin();
                document.getElementById('admin-pass-input').value = "";
            } else {
                alert("Sai mật khẩu!");
            }
        }

        function loadAdminData() {
            const history = JSON.parse(localStorage.getItem('sdc_history')) || [];
            const tbody = document.getElementById('admin-table-body');
            tbody.innerHTML = "";
            
            // Sắp xếp mới nhất lên đầu
            history.reverse().forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.timestamp}</td>
                    <td><b>${item.empCode}</b></td>
                    <td>${item.score}/10</td>
                    <td>${item.time}</td>
                `;
                tbody.appendChild(tr);
            });
            
            if(history.length === 0) tbody.innerHTML = "<tr><td colspan='4'>Chưa có dữ liệu</td></tr>";
        }

        // --- STORAGE ---
        function saveResultToStorage(empCode, score, timeDuration) {
            const history = JSON.parse(localStorage.getItem('sdc_history')) || [];
            const now = new Date();
            const timeString = `${now.getHours()}:${now.getMinutes()} ${now.getDate()}/${now.getMonth()+1}`;
            
            history.push({
                empCode: empCode,
                score: score,
                time: timeDuration,
                timestamp: timeString
            });
            
            localStorage.setItem('sdc_history', JSON.stringify(history));
        }
    </script>
</body>
</html>